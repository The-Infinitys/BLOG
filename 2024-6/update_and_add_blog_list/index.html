
<!DOCTYPE html>
<html lang="Ja">
  <head>
    <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="The Infinity's awesome blog article" />
    <meta name="description" content="The Infinity's awesome blog article" />
    <title>ブログをさらに進化させる</title>
    <link rel="stylesheet" href="../../Infinity-style/style.css" />
    <script defer src="../../Infinity-style/script.js"></script>
    <script defer src="/The-Infinitys-Infinity/script.js"></script>
    <link rel="stylesheet" href="/The-Infinitys-Infinity/style.css">
    <script defer src="/The-Infinitys-Infinity/script.js"></script>
    <link rel="stylesheet" href="/The-Infinitys-Infinity/style.css" />
    <script
    defer
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2045274771035552"
    crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="article-body">
      <div id="article-content">
        <h2 id="_1">前までなかったもの</h2>
        <h3 id="_2">私のブログに足りないもの</h3>
        <p>他の人のブログを見ていて気になったことがあります。<br />
        大体のブログには、ブログ記事を見終わると次の記事が見れるように、ページの最下部の方に<br />
        記事のリストがあるのですが、私のものにはそれがない！困ったもんです！というわけで早速作ることにしました！</p>
        <h3 id="_3">一体何が足りないのだろうか</h3>
        <blockquote>
        <p><a href="https://elekibear.com/post/20240101_01_next_elekibear"><img style="width:100%;aspect-ratio:1620/1287;" src="./img/elekibear-blog-article.png" alt="" /></a><br />
        都会のエレキベアと検索したら出てくるプラスモさんのブログなのですが、<br />
        下部に新着記事と書いてあって他の記事へのリンクがあります。<br />
        ですが私のブログにはそんなものはありませんでした<br />
        ٩( ᐛ )وどないしようか</p>
        </blockquote>
        <h2 id="_4">どうやってやろうか</h2>
        <h3 id="_5">記事が多過ぎた</h3>
        <p>記事そのものを書き換えようにも既に20以上の記事を書いており、全てに変更を適用するのは余りにも面倒なので、共通スクリプトの<a href="../../Infinity-style/">Infinity-style</a>に書き足すことで記事リストの追加を図ろうと思います。<a href="../../../blog/script.js">blogのscript</a>からブログの検索、リンクボタンの追加などのプログラムを取り出し、<a href="../../Infinity-style/script.js">Infinity-style/script.js</a>に取り入れます。その際に、プログラムの改造を施して、過去2ヶ月の記事の中から月毎にそれぞれ3記事ずつ(合計6つ)の記事を取り出すようにします。そして完成したのがこちら。</p>
        <h3 id="javascript">JavaScriptのソース</h3>
        <div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #0000ff">const</span> main = () =&gt; {<span style="color: #008000">//add article</span>
          <span style="color: #0000ff">const</span> article_text = document.body.innerHTML;
          document.body.innerHTML = <span style="color: #a31515">&quot;&quot;</span>;
          <span style="color: #0000ff">const</span> article_content = document.createElement(<span style="color: #a31515">&quot;div&quot;</span>);
          article_content.id = <span style="color: #a31515">&quot;article-content&quot;</span>;
          article_content.innerHTML = article_text;
          <span style="color: #0000ff">const</span> article_body = document.createElement(<span style="color: #a31515">&quot;div&quot;</span>);
          article_body.append(article_content);
          document.body.append(article_body);
          <span style="color: #008000">//add title</span>
          <span style="color: #0000ff">const</span> title_elem = document.querySelector(<span style="color: #a31515">&quot;title&quot;</span>);
          <span style="color: #0000ff">const</span> article_title = document.createElement(<span style="color: #a31515">&quot;div&quot;</span>);
          article_title.id = <span style="color: #a31515">&quot;article-title&quot;</span>;
          article_title.innerHTML = <span style="color: #a31515">&quot;&lt;h1&gt;&quot;</span> + title_elem.innerHTML + <span style="color: #a31515">&quot;&lt;/h1&gt;&quot;</span>;
          article_body.prepend(article_title);
          <span style="color: #008000">//add index</span>
          <span style="color: #0000ff">const</span> article_index = document.createElement(<span style="color: #a31515">&quot;div&quot;</span>);
          article_index.id = <span style="color: #a31515">&quot;article-index&quot;</span>;
          article_body.append(article_index);
          <span style="color: #0000ff">for</span> (<span style="color: #0000ff">let</span> i = 0; i &lt; article_content.children.length; ++i) {
            <span style="color: #0000ff">const</span> article_content_child = article_content.children[i];
            <span style="color: #0000ff">const</span> tags = { <span style="color: #a31515">&quot;H1&quot;</span>: <span style="color: #a31515">&quot;H1&quot;</span>, <span style="color: #a31515">&quot;H2&quot;</span>: <span style="color: #a31515">&quot;H2&quot;</span>, <span style="color: #a31515">&quot;H3&quot;</span>: <span style="color: #a31515">&quot;H3&quot;</span>, <span style="color: #a31515">&quot;H4&quot;</span>: <span style="color: #a31515">&quot;H4&quot;</span> };
            <span style="color: #0000ff">if</span> (article_content_child.tagName <span style="color: #0000ff">in</span> tags) {
              <span style="color: #0000ff">const</span> index_text = document.createElement(article_content_child.tagName);
              index_text.innerHTML = article_content_child.innerHTML;
              index_text.onclick = () =&gt; {
                article_content_child.scrollIntoView({
                  behavior: <span style="color: #a31515">&#39;smooth&#39;</span>,
                  block: <span style="color: #a31515">&#39;end&#39;</span>,
                  inline: <span style="color: #a31515">&#39;center&#39;</span>
                });
              }
              article_index.append(index_text);
            }
          }
          <span style="color: #0000ff">const</span> other_articles = document.createElement(<span style="color: #a31515">&quot;div&quot;</span>);
          other_articles.id = <span style="color: #a31515">&quot;other-articles&quot;</span>;
          article_body.append(other_articles);
          <span style="color: #0000ff">const</span> get_all_article_info = () =&gt; {
            <span style="color: #0000ff">const</span> blog_start = {
              year: 2024,
              month: 4
            }
            <span style="color: #0000ff">let</span> today = <span style="color: #0000ff">new</span> Date();
            today = {
              year: today.getFullYear(),
              month: today.getMonth() + 1
            }
            <span style="color: #0000ff">const</span> data_list_length = 1 + 12 * (today.year - blog_start.year) + today.month - blog_start.month;
            <span style="color: #0000ff">const</span> domain = <span style="color: #0000ff">new</span> URL(window.location.href);
            <span style="color: #0000ff">const</span> blog_domain = domain.hostname;
            <span style="color: #0000ff">const</span> append_blog_button = info =&gt; {
              <span style="color: #0000ff">const</span> box = document.createElement(<span style="color: #a31515">&quot;button&quot;</span>);
              box.classList.add(<span style="color: #a31515">&quot;blog-button&quot;</span>);
              box.onclick = () =&gt; {
                window.location.href = <span style="color: #a31515">&quot;https://&quot;</span> + blog_domain + info.index;
              }
              <span style="color: #0000ff">const</span> thumbnail = document.createElement(<span style="color: #a31515">&quot;img&quot;</span>);
              thumbnail.src = <span style="color: #a31515">&quot;https://&quot;</span> + blog_domain + info.thumbnail;
              thumbnail.alt = info.name;
              thumbnail.loading = <span style="color: #a31515">&quot;lazy&quot;</span>;
              <span style="color: #0000ff">const</span> loading = document.createElement(<span style="color: #a31515">&quot;img&quot;</span>);
              loading.src = <span style="color: #a31515">&quot;data:image/svg+xml;base64,PHN2ZyAgIHZlcnNpb249IjEuMSIgICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciICAgdmlld0JveD0iLTYwIC02MCAxMjAgMTIwIiAgIGZpbGw9Im5vbmUiICAgc3Ryb2tlPSIjNzc3Ij4gICA8Zz4gICA8YW5pbWF0ZVRyYW5zZm9ybSAgICBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iICAgICBhdHRyaWJ1dGVUeXBlPSJYTUwiICAgICB0eXBlPSJyb3RhdGUiICAgICBmcm9tPSIwIDAgMCIgICAgIHRvPSIzNjAgMCAwIiAgICAga2V5VGltZXM9IjA7IDEiICAgICBrZXlTcGxpbmVzPSIwLjUsIDAuMjMsIDAuNSwgMC43NyIgICAgIGNhbGNNb2RlPSJzcGxpbmUiICAgICBkdXI9IjJzIiAgICAgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiLz4gICA8YW5pbWF0ZSAgICAgICBhdHRyaWJ1dGVOYW1lPSJzdHJva2UiICAgICAgIHZhbHVlcz0iI2YwMDsjZmYwOyMwZjA7IzBmZjsjMDBmOyNmMGY7I2YwMCIgICAgICAgZHVyPSI1cyIgICAgICAgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIC8+ICAgPGVsbGlwc2UgY3g9Ii0yNSIgY3k9IjAiIHJ4PSIyNSIgcnk9IjIwIiBzdHJva2Utd2lkdGg9IjIiIC8+ICAgPGVsbGlwc2UgY3g9IjI1IiBjeT0iMCIgcng9IjI1IiByeT0iMjAiIHN0cm9rZS13aWR0aD0iMiIgLz4gICA8Y2lyY2xlIGN4PSIwIiBjeT0iMCIgcj0iNTAiIHN0cm9rZS13aWR0aD0iNCIgLz4gICA8L2c+IDwvc3ZnPiA=&quot;</span>;
              loading.alt = <span style="color: #a31515">&quot;loading...&quot;</span>;
              loading.className = <span style="color: #a31515">&quot;loading-infinity&quot;</span>;
              <span style="color: #0000ff">const</span> title = document.createElement(<span style="color: #a31515">&quot;div&quot;</span>);
              title.innerHTML = info.title;
              box.innerHTML = loading.outerHTML + thumbnail.outerHTML + title.outerHTML;
              <span style="color: #0000ff">const</span> insert_button = () =&gt; {
                document.querySelector(<span style="color: #a31515">&quot;#other-articles&quot;</span>).append(box);
              }
              insert_button();
            };
            <span style="color: #0000ff">const</span> getData = (name) =&gt; {
              console.log(<span style="color: #a31515">&quot;get: &quot;</span> + <span style="color: #a31515">&quot;https://&quot;</span> + blog_domain + name + <span style="color: #a31515">&quot;.json&quot;</span>);
              fetch(<span style="color: #a31515">&quot;https://&quot;</span> + blog_domain + name + <span style="color: #a31515">&quot;.json&quot;</span>)
                .then((res) =&gt; res.json()).then(
                  data =&gt; {
                    <span style="color: #0000ff">const</span> infos = data.info;
                    <span style="color: #0000ff">let</span> counter = 3;
                    <span style="color: #0000ff">for</span> (<span style="color: #0000ff">let</span> i = 0; i &lt; infos.length; ++i) {
                      <span style="color: #0000ff">const</span> info = infos[i];
                      <span style="color: #0000ff">if</span> (Math.random() &lt; 1 / (infos.length - i - counter)) {
                        <span style="color: #0000ff">if</span> (counter &gt; 0) {
                          append_blog_button(info);
                          counter--;
                        }
                      }
                    }
                  }
                ).<span style="color: #0000ff">catch</span>((err) =&gt; console.log(<span style="color: #a31515">`データが取得できませんでした：${</span>err<span style="color: #a31515">}`</span>));
            };
            <span style="color: #0000ff">for</span> (<span style="color: #0000ff">let</span> load_count = data_list_length; load_count &gt; data_list_length - 2; --load_count) {
              <span style="color: #0000ff">const</span> pathname = <span style="color: #a31515">&quot;/api/blog/&quot;</span> + (blog_start.year + ~~((blog_start.month + load_count - 1) / 12)).toString() + <span style="color: #a31515">&quot;-&quot;</span> + ((blog_start.month + load_count - 2) % 12 + 1).toString()
              getData(pathname);
            }
          };
          get_all_article_info();
          <span style="color: #008000">//add style</span>
          fetch(<span style="color: #a31515">&quot;https://&quot;</span> + <span style="color: #0000ff">new</span> URL(window.location.href).hostname + <span style="color: #a31515">&quot;/The-Infinitys-Infinity/style.css&quot;</span>).then(res =&gt; res.text()).then(style =&gt; {
            <span style="color: #0000ff">const</span> The_Infinitys_css = document.createElement(<span style="color: #a31515">&quot;style&quot;</span>);
            The_Infinitys_css.innerHTML = style;
            document.body.append(The_Infinitys_css);
          }).<span style="color: #0000ff">catch</span>(err =&gt; alert(err));
          fetch(<span style="color: #a31515">&quot;https://&quot;</span> + <span style="color: #0000ff">new</span> URL(window.location.href).hostname + <span style="color: #a31515">&quot;/The-Infinitys-Infinity/script.js&quot;</span>).then(res =&gt; res.text()).then(style =&gt; {
            <span style="color: #0000ff">const</span> The_Infinitys_js = document.createElement(<span style="color: #a31515">&quot;script&quot;</span>);
            The_Infinitys_js.innerHTML = style;
            document.body.append(The_Infinitys_js);
          }).<span style="color: #0000ff">catch</span>(err =&gt; alert(err));
        };
        main();
        </code></pre></div>
        
        <h3 id="css">CSSのソース</h3>
        <p>あとcssも</p>
        <div class="codehilite" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code>* {
          <span style="color: #0000ff">margin</span>: 0;
          <span style="color: #0000ff">padding</span>: 0;
        }
        
        :root {
          --article-back: #eee;
          --article-text: #000;
        }
        
        @<span style="color: #0000ff">media</span> (prefers-color-scheme: dark) {
          :root {
            --article-back: #111;
            --article-text: #fff;
          }
        
          a {
            <span style="color: #0000ff">color</span>: <span style="color: #0000ff">aqua</span>;
          }
        }
        
        body {
          <span style="color: #0000ff">background-color</span>: var(--article-back);
        }
        
        #article-title {
          <span style="color: #0000ff">margin-left</span>: 10<span style="color: #2b91af">vw</span>;
          <span style="color: #0000ff">width</span>: 50<span style="color: #2b91af">%</span>;
          <span style="color: #0000ff">height</span>: <span style="color: #0000ff">auto</span>;
          <span style="color: #0000ff">text-wrap</span>: <span style="color: #0000ff">wrap</span>;
          <span style="color: #0000ff">color</span>: var(--article-text);
        }
        
        #article-content {
          <span style="color: #0000ff">margin-top</span>: 5<span style="color: #2b91af">vh</span>;
          <span style="color: #0000ff">margin-left</span>: 10<span style="color: #2b91af">vw</span>;
          <span style="color: #0000ff">margin-bottom</span>: 5<span style="color: #2b91af">vh</span>;
          <span style="color: #0000ff">padding</span>: 2<span style="color: #2b91af">%</span>;
          <span style="color: #0000ff">width</span>: 50<span style="color: #2b91af">%</span>;
          <span style="color: #0000ff">height</span>: max(<span style="color: #0000ff">auto</span>, 80<span style="color: #2b91af">vh</span>);
          <span style="color: #0000ff">color</span>: var(--article-text);
          <span style="color: #0000ff">background-color</span>: color-mix(in srgb, var(--article-back), #888 20<span style="color: #2b91af">%</span>);
          <span style="color: #0000ff">overflow</span>: <span style="color: #0000ff">hidden</span>;
          <span style="color: #0000ff">overflow-wrap</span>: <span style="color: #0000ff">break-word</span>;
        }
        
        #article-index {
          <span style="color: #0000ff">position</span>: <span style="color: #0000ff">sticky</span>;
          <span style="color: #0000ff">width</span>: 30<span style="color: #2b91af">%</span>;
          <span style="color: #0000ff">height</span>: 70<span style="color: #2b91af">vh</span>;
          <span style="color: #0000ff">bottom</span>: 15<span style="color: #2b91af">vh</span>;
          <span style="color: #0000ff">left</span>: 65<span style="color: #2b91af">%</span>;
          <span style="color: #0000ff">overflow</span>: <span style="color: #0000ff">scroll</span>;
          <span style="color: #0000ff">color</span>: var(--article-text);
          <span style="color: #0000ff">background-color</span>: color-mix(in srgb, <span style="color: #0000ff">color</span>-mix<span style="border: 1px solid #FF0000">(</span>in srgb, var(--article-back), <span style="color: #0000ff">transparent</span> 50<span style="color: #2b91af">%</span>), #888 10<span style="color: #2b91af">%</span>);
        }
        
        #other-articles {
          <span style="color: #0000ff">margin-top</span>: -70<span style="color: #2b91af">vh</span>;
          <span style="color: #0000ff">margin-left</span>: 10<span style="color: #2b91af">vw</span>;
          <span style="color: #0000ff">margin-bottom</span>: 10<span style="color: #2b91af">vh</span>;
          <span style="color: #0000ff">width</span>: calc(50<span style="color: #2b91af">vw</span> + 2 * 2<span style="color: #2b91af">vw</span>);
          aspect-ratio: 8/9;
          <span style="color: #0000ff">background-color</span>: color-mix(in srgb, var(--article-back), #888 20<span style="color: #2b91af">%</span>);
        }
        
        .<span style="color: #2b91af">blog-button</span> {
          <span style="color: #0000ff">overflow</span>: <span style="color: #0000ff">hidden</span>;
          <span style="color: #0000ff">position</span>: <span style="color: #0000ff">relative</span>;
          <span style="color: #0000ff">background-color</span>: #ffffff55;
        
          <span style="border: 1px solid #FF0000">@media</span> <span style="border: 1px solid #FF0000">(</span>prefers-color-scheme: dark) <span style="border: 1px solid #FF0000">{</span>
            <span style="color: #0000ff">background-color</span>: #00000055;
          }
        
          width:50%;
          aspect-ratio: 4/3;
        <span style="border: 1px solid #FF0000">}</span>
        
        .<span style="color: #2b91af">blog-button</span> img {
          <span style="color: #0000ff">position</span>: <span style="color: #0000ff">absolute</span>;
          <span style="color: #0000ff">top</span>: 0;
          <span style="color: #0000ff">left</span>: 0;
          <span style="color: #0000ff">width</span>: 100<span style="color: #2b91af">%</span>;
          <span style="color: #0000ff">height</span>: 85<span style="color: #2b91af">%</span>;
          <span style="color: #0000ff">object-fit</span>: <span style="color: #0000ff">cover</span>;
        }
        
        .<span style="color: #2b91af">loading-infinity</span> {
          <span style="color: #0000ff">position</span>: <span style="color: #0000ff">absolute</span>;
          <span style="color: #0000ff">top</span>: 0;
          <span style="color: #0000ff">left</span>: 0;
          <span style="color: #0000ff">width</span>: 100<span style="color: #2b91af">%</span>;
          <span style="color: #0000ff">height</span>: 85<span style="color: #2b91af">%</span>;
          <span style="color: #0000ff">object-fit</span>: <span style="color: #0000ff">contain</span>;
        }
        
        .<span style="color: #2b91af">blog-button</span> div {
          <span style="color: #0000ff">position</span>: <span style="color: #0000ff">absolute</span>;
          <span style="color: #0000ff">width</span>: 100<span style="color: #2b91af">%</span>;
          <span style="color: #0000ff">height</span>: 15<span style="color: #2b91af">%</span>;
          <span style="color: #0000ff">bottom</span>: 0;
          <span style="color: #0000ff">color</span>: var(--text);
          <span style="color: #0000ff">font-size</span>: max(<span style="color: #0000ff">auto</span>, 12<span style="color: #2b91af">px</span>);
        }
        
        @<span style="color: #0000ff">media</span> (max-aspect-ratio: 1) {
          #article-index {
            <span style="color: #0000ff">visibility</span>: <span style="color: #0000ff">hidden</span>;
          }
        
          #article-title {
            <span style="color: #0000ff">margin-left</span>: 2.5<span style="color: #2b91af">vw</span>;
            <span style="color: #0000ff">width</span>: 90<span style="color: #2b91af">%</span>;
          }
        
          #article-content {
            <span style="color: #0000ff">margin-left</span>: 2.5<span style="color: #2b91af">vw</span>;
            <span style="color: #0000ff">width</span>: 90<span style="color: #2b91af">%</span>;
          }
        
          #other-articles {
            <span style="color: #0000ff">margin-left</span>: 2.5<span style="color: #2b91af">vw</span>;
            <span style="color: #0000ff">width</span>: 94<span style="color: #2b91af">%</span>;
          }
        }
        
        pre {
          <span style="color: #0000ff">position</span>: <span style="color: #0000ff">relative</span>;
          <span style="color: #0000ff">white-space</span>: <span style="color: #0000ff">pre-wrap</span>;
          <span style="color: #0000ff">word-wrap</span>: <span style="color: #0000ff">break-word</span>;
          <span style="color: #0000ff">overflow</span>: <span style="color: #0000ff">auto</span>;
          <span style="color: #0000ff">background-color</span>: color-mix(in srgb, <span style="color: #0000ff">color</span>-mix<span style="border: 1px solid #FF0000">(</span>in srgb, var(--article-back), <span style="color: #0000ff">transparent</span> 50<span style="color: #2b91af">%</span>), #888 30<span style="color: #2b91af">%</span>);
          <span style="color: #0000ff">color</span>: var(--article-text);
          <span style="color: #0000ff">padding</span>: 10<span style="color: #2b91af">px</span>;
          <span style="color: #0000ff">border-radius</span>: 4<span style="color: #2b91af">px</span>;
          <span style="color: #0000ff">font-size</span>: 15<span style="color: #2b91af">px</span>;
        }
        </code></pre></div>
        
        <p>我ながらかなり難しかった&hellip;</p>
        <h2 id="_6">感想</h2>
        <p>個人的には大満足の出来でした。ですがやはり今まで貯めてきたプログラムが無ければ作業は難航していたでしょう&hellip;<br />
        あ、<a href="https://scratch.mit.edu/projects/1037788134/">scratch</a>にもあるのでよろしく。<br />
        <date>2024/06/15</date></p>
      </div>
    </div>
  </body>
</html>
